// index.ts
import pico from 'picocolors'

const PLUGIN_NAME = 'vite-plugin-kuaikuai'

interface PluginOptions {
  /**
   * Whether to log when running `vite build`
   *
   * @default false
   */
  onBuild?: boolean
  /**
   * Whether to log when running `vite dev`
   *
   * @default false
   */
  onDev?: boolean
}

const kuaiKuaiPlugin = (options: PluginOptions = {}) => {
  const { onBuild = false, onDev = false } = options

  function logKuaiKuai () {
    console.log(pico.green(`
                               ███████████                               
                           ████████████████████                          
                        ████████████████████████████████████▓            
                      ██████████████████████████████▓▒░░░▓▓▓██           
                    ██████████████████████████████████▓▓▓▓▓▓▓▓▓          
        ████       ████████████████████████████████████▓▓▓▓▓▓▓█          
     ████████     ██████████████████████████████████████▓▓█▓▓▓█▓         
  ████████████   ██████████████████████████████████████████████▓         
  █████████████████████████████████████████████████████████████▓         
  ████████████████▓▒░░▒▓███▓▒░░░▒▒▒▓██████████████████████ ▓██▓          
   ██████████████▓░░░░░▒██▓▒███▒░░░░░░▒████████████████████              
    █████████████▒░░▒▒░▒█▓░░▒░░░░░░░░▓▓▒░▒█████████████████              
    █████████████▓░░░░▒▓▓░░▓█▓░░░░░░░░▓██░░▒███████████████              
     ████████████▓▒▒▒░░░░░░▒▓░░░░░░▒██▒░░░░░███████████████              
   ▒░░▒███████████▓░░░░░▓█░░░░░░▒░░▓█▓░░░░░█████████████████             
 ░░░░░░░▓█████████▒░░░░▒███▒░░░░░░░░░░░░░░██▓▒░░░░▒█████████             
 ▒░░░░░░░▓██▓░░▒▓█▒░░░░██▓░░░▒▒▒▒▒▒▓█▓▒░░░░▒░░░▒░░░▓█████████      ███   
░░░ ░░░░░░░░░░░░▓█▒░░░░███▒░▒▓░░░▓███▒░░░░░░░▒▒▒░░▒▓███████████████████  
 ░░░ ░░░░    ░░▓██▓░░░░▒▒▒▒▓▓█▓▒▒▓██▒░░░░░░░░░░░░▒██████████████████████ 
    ░░   ░░  ░▒████▓░░░▒▒▒▒▒▒▒▒▒▒▓▓▒░░░░░░▒▓▓▓▓█████████████████████████ 
    ▒░░░░░ ░░░▓▓▓███▓░░░▒▒▒▒▒▒▒▒▒▒░░░░░░░▓████▓▓▓████████████████████████
      ▒░░░░░▒▓▓▓▓▓▓▓█▓▒░░░▒▒▒▒▒▒░░░░░░░▒▓████▓░░░▒██████████████████████ 
       ██▓▒▓▓▓▓▓▓▓▓▓▓░░░▒▒░░░░░░░░░░▒▓███████▒░ ░▒████▓▒░▒▓██████████    
       ███▓▓▓▓▓▓▓▓▓▒░░░▒▒░░▓▒▒▒▒▒▒▒▓▓▓██████▓░  ░░░░░░░░░░░▓██████       
         ▓█████▓▓█▓░░░░░▓▒▒▒░░░░░▒▓▓▓▓▓▓▓▓▓▓░░░░░░░ ░░░░░░░▒▓            
                  █▓▓▓▓▓▓▓▓▓░░░░░░▓▓▓▓▓▓▓▓▓▓░░ ░░░░░ ░░░░░▒░             
                  █▓▓▓▓▓▓▓▓█▓▒░░▒▓▓█▓▓▓▓▓▓▓▓▒░░░░░ ░░░░░░▒░              
                 ██▓▓▓▓▓▒▒▓▓▓▓▓▓▓▓▓▓▓██▓▓▓▓█▓██▒▒▒░░                     
                 █▓▓▓▓▓▓▓▓▓█▓▓▓▓▓▓▓▓▓▓▓▓▓█████                           
                 ██▓▓▓▓▓█████▓▓▓▓▓▓▓▓██▓                                 
                 ▓▓█▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█                                 
                   ▓▓▓▓▓▓▓▓▓▓█▓▓▓▓▓▓▓▓▓▓█                                
                    ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓                              
          ▓▓▓▓▓▓▓    █▓▓▓▓██▓   ▓█▓▓▓▓▓▓▓▓▓     ▓▓▓▓▓▓▓▓                 
       ▓▓▒▒▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▓▓      ▓▓▓▓▓▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▓▓              
     ▓▓▒▒▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▓▓            
   ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓         ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓           
    ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓          ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓           
        ▓▓▓▓██▓▓▓▓▓    ▓▓                       ▓▓▓▓▓█▓▓▓▓▓              
  `))
  }

  return {
    name: PLUGIN_NAME,
    configureServer () {
      if (onDev) {
        logKuaiKuai()
      }
    },
    closeBundle () {
      if (onBuild) {
        logKuaiKuai()
      }
    },
  }
}

export default kuaiKuaiPlugin
